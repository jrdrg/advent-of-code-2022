defmodule Input do
  @input "
  R 4
U 4
L 3
D 1
R 4
D 1
L 5
R 2"

  @input "
R 5
U 8
L 8
D 3
R 17
D 10
L 25
U 20"

  @input "
D 1
L 1
U 1
R 2
L 1
U 1
L 1
R 2
U 1
D 2
L 2
D 1
L 1
R 1
L 1
U 1
D 1
R 2
L 2
U 1
R 2
L 1
R 1
U 2
D 1
R 2
L 1
U 2
D 1
R 2
L 1
D 1
R 1
U 1
R 1
L 1
U 1
L 1
D 2
U 1
R 1
D 2
L 1
U 1
L 1
U 2
R 1
D 2
U 1
R 1
L 2
D 1
L 2
R 1
U 2
L 1
R 1
L 2
U 1
R 1
L 1
U 2
D 1
L 1
U 1
R 2
U 1
D 1
L 1
R 2
L 1
D 1
L 2
R 1
L 2
U 2
D 2
U 1
D 2
R 2
L 2
R 2
D 2
R 1
L 1
U 1
L 2
D 2
L 1
U 1
R 2
D 2
L 1
U 2
L 1
U 2
D 1
R 2
D 1
U 2
D 2
L 2
U 1
L 1
R 2
D 2
L 1
U 1
R 1
L 1
U 2
D 1
L 1
R 1
D 1
L 2
D 1
U 1
D 3
L 1
U 1
D 2
U 2
D 2
L 1
R 1
L 3
R 2
U 2
R 1
U 3
L 2
R 3
U 1
R 2
D 2
U 3
R 3
D 2
L 1
R 2
L 3
R 2
D 1
R 1
D 2
R 1
L 1
U 3
D 1
U 2
D 3
R 2
U 2
L 1
D 1
U 1
D 1
R 1
U 2
R 1
L 2
U 1
D 1
L 2
R 2
D 1
R 3
L 2
R 1
U 1
R 2
U 1
R 1
L 3
R 3
D 3
L 1
R 3
D 2
L 2
R 3
D 2
R 2
L 2
U 3
L 3
U 3
R 1
D 2
R 1
D 3
L 3
D 1
U 1
D 3
R 1
U 2
L 3
U 1
L 3
R 1
U 1
R 1
D 1
R 1
L 2
D 1
R 3
L 1
D 1
U 3
D 3
L 1
U 1
D 2
U 3
R 2
U 2
L 1
D 3
U 1
L 1
R 1
U 3
D 4
R 3
U 2
R 2
U 3
L 3
U 4
L 3
U 1
D 2
L 1
U 4
R 3
L 1
R 1
L 4
R 4
L 2
U 3
D 4
U 2
R 1
D 4
R 4
L 1
R 2
U 3
L 2
D 3
U 1
L 3
U 3
L 4
D 3
R 2
D 1
L 4
D 4
L 2
D 1
L 2
R 4
U 4
L 3
R 1
D 1
R 1
U 2
L 4
U 3
D 2
U 3
D 3
U 4
L 4
U 3
D 2
R 2
U 3
R 2
L 4
D 4
R 2
D 1
L 3
U 4
D 4
R 1
U 4
D 4
U 4
R 1
U 4
R 2
D 4
U 1
R 4
L 2
R 3
U 3
D 4
R 1
D 2
U 2
R 1
U 4
D 4
L 4
U 2
R 1
U 1
D 1
L 2
D 2
U 1
D 2
U 3
D 2
L 3
U 3
D 3
L 3
R 3
L 2
U 4
L 4
U 4
L 1
D 1
R 4
D 2
L 1
R 1
L 4
D 4
U 1
D 2
U 5
R 2
U 3
D 2
L 2
R 1
U 1
R 4
D 4
R 2
L 1
D 3
U 3
L 2
D 4
U 4
D 4
R 1
U 1
D 3
R 1
D 5
U 4
R 4
D 5
U 5
L 5
D 3
R 2
D 4
L 2
R 5
D 5
R 4
D 1
L 1
R 5
D 1
U 1
L 4
R 5
D 2
L 1
U 1
R 5
D 4
L 1
R 1
D 5
L 2
D 4
R 3
L 3
U 2
D 1
R 5
L 3
U 1
D 3
U 3
D 1
L 2
R 3
U 3
D 5
L 1
D 5
R 2
U 2
D 5
L 4
R 4
L 2
R 4
D 4
U 3
D 1
U 5
L 5
U 4
D 4
U 4
R 2
D 2
L 2
U 5
L 5
R 1
L 4
D 1
R 5
D 5
L 3
U 4
R 2
U 3
L 1
U 1
D 2
L 3
D 2
L 1
U 4
L 1
D 6
L 5
U 4
R 2
L 6
R 3
L 4
U 1
D 5
R 4
L 5
R 5
U 5
R 6
D 2
U 2
D 3
U 5
R 6
U 5
L 3
R 1
L 6
D 3
L 6
D 6
R 6
D 3
R 6
D 1
U 5
R 1
U 2
R 6
U 2
L 1
R 4
D 6
L 4
R 5
D 1
R 5
U 1
L 3
U 3
L 2
D 2
R 5
L 1
R 5
L 4
R 6
U 3
R 6
U 5
R 4
D 2
L 4
U 2
R 6
L 3
U 2
L 6
U 4
R 6
L 6
D 5
U 5
L 1
R 4
L 1
D 4
R 4
L 6
D 3
U 2
D 6
R 4
D 6
U 3
L 6
U 6
R 3
L 2
R 1
D 5
R 2
L 1
U 1
D 1
L 3
D 5
R 5
L 3
U 2
R 1
U 4
R 2
D 6
R 2
U 4
R 1
U 3
L 5
D 5
L 1
R 4
L 5
D 5
R 2
U 7
L 4
U 6
R 5
U 7
D 1
R 4
D 3
R 5
U 5
D 6
L 4
U 2
D 2
R 6
L 1
R 4
D 1
U 2
L 2
R 2
U 2
R 6
D 2
U 5
R 3
U 3
D 6
L 3
R 4
U 4
R 2
D 3
U 1
L 3
U 5
D 7
U 4
R 5
D 4
R 6
U 1
D 5
U 3
R 6
U 4
R 6
L 5
R 6
L 4
R 2
U 7
L 5
R 5
D 4
L 7
D 7
U 1
L 2
D 4
R 3
U 4
R 3
U 6
D 4
L 2
R 2
U 4
D 6
U 4
D 1
R 5
L 7
D 4
U 1
D 3
R 7
D 7
U 4
R 4
D 6
U 4
R 7
D 3
L 4
U 7
R 5
D 6
U 1
L 4
U 6
D 5
R 3
U 2
D 7
U 7
D 7
U 4
D 7
U 4
D 2
U 7
R 3
U 7
R 7
D 3
L 3
R 5
D 3
R 5
U 8
L 6
R 7
L 4
R 8
U 6
L 2
U 8
R 3
U 5
R 2
D 5
R 7
D 4
R 3
L 5
R 4
D 8
U 4
L 4
U 2
L 4
R 8
D 2
U 5
D 3
R 1
U 5
L 2
R 2
U 6
L 3
R 8
L 3
U 3
R 5
U 1
L 3
R 6
L 4
R 5
D 5
R 7
L 3
R 1
D 8
R 1
U 3
L 1
U 6
D 4
R 8
U 1
D 6
L 5
R 5
U 4
D 8
R 8
L 1
R 3
U 5
L 4
U 2
R 6
U 5
R 6
U 7
L 1
R 1
L 8
R 7
U 8
R 6
U 1
L 1
R 3
D 4
R 6
L 7
D 4
U 7
R 7
U 6
L 6
D 4
R 5
U 1
D 8
R 2
D 1
R 6
L 3
D 7
R 5
L 4
D 4
U 3
D 3
R 3
U 3
L 8
D 1
L 7
D 7
R 2
L 1
U 2
D 8
R 1
U 7
L 8
U 3
R 5
U 7
D 7
U 3
L 5
U 1
D 3
U 6
R 9
L 7
U 8
L 6
R 4
L 1
R 6
U 4
L 4
R 4
D 6
L 9
D 2
L 2
R 5
L 8
U 2
R 5
U 4
L 2
D 6
U 8
D 8
U 4
R 1
D 9
U 5
D 8
R 1
U 7
D 4
L 4
R 3
L 2
D 4
L 9
D 1
U 2
L 2
R 1
D 5
U 8
R 8
U 9
L 8
D 4
U 6
L 1
D 8
L 6
U 3
R 2
L 7
D 6
U 7
D 7
L 8
R 2
U 2
L 6
D 6
U 4
R 3
L 5
D 4
R 3
D 6
L 5
R 7
U 3
L 6
U 6
R 8
D 5
U 7
R 4
U 2
D 6
R 9
U 3
D 3
U 1
L 4
R 8
D 8
L 2
D 3
L 9
U 6
R 4
L 3
R 8
L 3
D 9
L 2
D 3
U 1
D 3
U 2
L 1
U 9
L 8
D 1
L 9
U 1
L 2
D 9
R 10
D 8
R 9
D 3
U 9
D 5
R 9
U 5
D 3
U 4
D 10
L 3
R 1
D 4
U 1
L 4
U 4
D 7
L 8
D 8
L 3
R 3
L 9
R 3
D 4
R 9
L 1
D 4
U 5
L 7
D 9
R 4
U 3
L 4
D 2
L 9
U 3
D 10
L 4
D 7
R 7
L 6
U 2
D 9
U 5
R 7
L 7
U 4
L 7
R 1
L 10
R 9
U 1
L 9
U 3
L 6
U 9
R 8
L 2
R 1
U 9
R 7
D 1
L 1
R 5
U 7
L 7
D 6
R 2
U 2
D 1
L 10
U 9
D 1
L 5
R 9
D 2
L 1
R 6
D 9
U 3
L 9
R 7
L 6
U 2
R 6
L 2
D 6
U 8
D 7
L 1
R 2
U 7
R 5
U 2
L 10
D 2
L 4
R 8
L 5
D 4
L 4
R 3
U 3
D 10
R 8
U 8
D 10
U 4
R 2
L 11
U 10
R 2
U 2
L 11
R 11
D 3
U 11
L 11
R 1
L 9
D 10
R 8
L 2
D 1
L 1
D 9
R 6
D 10
U 4
L 7
U 5
L 3
U 1
D 3
U 1
L 10
R 3
D 11
U 11
L 9
R 5
L 7
D 1
R 11
U 10
D 6
L 8
R 2
L 7
U 7
L 6
D 11
R 1
L 11
D 9
U 6
D 2
L 2
U 1
L 10
D 5
U 8
D 3
R 6
U 11
R 3
D 5
U 7
L 3
U 4
D 5
L 8
D 10
R 7
D 4
U 10
L 7
R 5
L 3
R 6
U 5
D 9
R 8
L 2
U 6
R 5
D 3
U 11
R 3
U 3
D 1
L 11
D 10
R 1
U 11
R 6
U 1
L 8
D 10
U 5
L 4
R 5
U 4
L 5
D 3
U 9
L 9
D 3
R 6
D 8
U 8
R 3
L 8
R 3
U 2
D 11
R 7
L 2
U 1
L 8
R 6
L 1
D 6
U 9
L 9
D 2
L 7
D 7
U 8
D 4
R 11
D 2
U 7
D 10
R 8
L 9
U 9
R 11
L 9
D 9
U 1
R 2
D 4
U 2
D 8
R 2
D 3
R 8
L 5
R 5
U 7
D 3
R 12
L 1
U 8
L 9
R 1
U 8
L 1
U 8
L 4
D 3
R 9
L 8
U 11
D 3
L 12
D 1
U 11
R 8
D 1
R 4
D 3
U 12
R 6
U 12
R 6
U 5
D 10
L 9
R 1
U 12
D 5
L 1
R 6
U 9
L 9
D 3
R 9
D 11
U 1
L 3
U 10
D 4
L 9
R 3
L 8
D 2
R 2
D 2
R 5
D 8
R 7
L 9
D 12
L 5
U 8
L 5
R 5
U 3
D 7
R 7
U 8
R 1
D 6
R 12
D 9
R 9
L 5
R 11
L 10
R 9
L 2
R 4
D 1
R 3
U 11
L 10
U 6
D 11
U 13
D 6
L 1
D 7
R 13
U 4
D 1
R 12
D 11
L 7
U 11
D 9
U 10
R 1
D 7
U 11
R 11
U 8
L 6
D 3
L 3
D 9
R 3
D 1
U 11
D 1
R 6
L 2
R 8
U 10
L 7
D 8
U 12
R 12
U 8
L 1
U 8
R 13
L 9
D 1
L 8
R 6
L 10
R 8
D 11
R 3
U 4
L 2
U 4
D 12
U 1
L 12
R 9
L 11
R 2
U 12
R 5
L 12
D 4
L 7
U 10
L 4
R 11
D 6
R 6
L 3
D 3
U 9
D 6
L 8
R 1
U 12
R 12
U 12
D 1
R 3
L 11
D 7
U 7
R 12
D 1
R 10
D 10
U 5
D 8
R 11
L 13
U 5
D 10
L 4
R 13
L 1
U 6
L 10
D 7
L 3
R 4
U 13
D 4
R 12
U 6
D 7
R 10
U 3
R 1
L 11
R 3
L 3
D 8
R 6
U 7
D 13
U 13
L 12
R 14
D 7
U 2
R 4
L 14
U 4
L 10
R 13
U 9
D 2
U 1
L 9
D 13
R 4
U 10
L 8
D 9
U 9
D 6
U 13
R 2
U 13
L 5
U 5
D 14
R 9
L 7
D 8
R 12
L 7
U 6
D 4
L 14
U 11
D 4
L 12
U 7
L 3
U 12
R 13
U 6
R 6
L 8
R 5
U 4
D 5
R 9
U 7
D 9
U 4
R 2
D 5
L 4
D 1
R 13
D 11
U 12
L 7
R 12
U 8
L 3
U 13
D 5
R 12
U 6
D 7
U 1
D 11
L 4
R 14
U 12
L 3
D 13
U 2
R 2
L 6
D 8
U 6
D 14
U 1
R 1
D 1
U 13
L 6
U 11
D 9
L 1
D 7
U 8
D 6
U 7
D 11
R 5
U 11
D 13
L 5
D 14
L 4
U 1
L 8
R 9
D 11
U 2
L 9
D 13
L 5
D 1
L 5
R 11
U 15
D 8
U 9
D 3
L 5
R 12
U 11
L 5
D 2
L 1
U 14
R 13
D 9
L 2
U 8
D 5
R 2
D 13
L 10
U 1
L 5
D 10
U 13
L 15
U 2
R 3
D 15
R 15
L 12
R 14
L 7
U 3
R 12
L 5
R 4
L 8
D 11
R 2
L 13
D 15
U 9
R 10
U 6
L 1
D 11
L 14
D 5
R 11
L 5
U 13
R 9
L 2
D 2
U 7
L 11
D 8
L 11
R 3
D 2
L 13
D 15
R 2
D 13
L 7
U 8
D 8
U 9
R 1
D 7
L 5
R 1
D 9
R 3
L 5
D 10
R 6
D 11
U 15
L 15
U 12
D 7
L 11
D 13
L 11
D 13
L 1
D 15
L 3
R 1
U 2
L 6
R 7
D 5
L 6
R 12
L 3
U 1
D 1
L 10
R 15
L 9
U 1
L 12
U 14
L 3
U 10
L 5
U 5
L 13
R 15
L 1
D 11
U 4
R 7
D 13
U 3
D 12
R 14
U 5
R 12
D 5
U 6
R 3
U 2
D 12
R 3
L 3
D 10
U 6
L 12
U 8
L 1
U 13
L 2
R 3
L 9
R 10
U 10
D 2
U 15
D 3
U 13
L 13
R 12
L 12
U 7
L 14
D 15
U 14
D 14
L 14
U 5
R 2
D 12
U 14
L 2
D 12
L 8
U 7
L 6
D 6
L 13
U 2
L 10
R 11
U 4
D 6
R 15
U 7
R 10
U 4
L 7
D 13
U 8
L 13
U 3
L 4
D 11
U 14
R 8
L 1
R 16
L 1
D 8
R 6
D 12
U 4
L 9
D 9
U 10
R 8
L 10
D 14
R 11
L 6
U 14
R 9
U 13
D 9
U 3
R 14
U 16
D 16
R 2
L 12
R 5
L 1
U 4
D 8
U 15
L 1
U 5
D 4
L 3
D 7
R 8
L 6
U 3
L 10
R 9
D 2
R 7
L 15
R 6
D 8
U 17
D 9
U 9
L 8
U 7
D 3
U 11
L 2
R 17
U 13
D 4
R 9
L 9
U 4
D 12
R 16
L 12
U 17
R 8
D 7
R 6
D 8
L 7
D 4
U 15
D 11
R 15
D 8
R 6
U 4
D 11
U 4
R 17
D 7
L 12
D 3
U 10
D 11
L 5
U 7
L 8
D 14
U 9
D 9
U 5
R 4
D 1
U 16
D 5
R 10
L 9
D 15
R 16
U 7
R 16
D 8
U 3
D 9
L 13
D 16
L 10
U 12
R 13
L 9
U 5
D 2
U 12
L 17
U 7
D 8
R 13
D 17
L 8
U 9
R 15
D 17
U 8
L 5
R 2
U 3
R 14
L 7
R 17
D 1
L 7
R 12
D 11
U 4
L 17
U 5
R 14
D 13
U 16
L 16
R 14
L 17
U 9
L 5
U 11
L 17
R 11
D 14
R 15
D 15
L 1
D 7
U 14
R 7
U 8
L 2
U 2
D 16
L 7
U 11
R 9
L 14
R 8
U 17
D 16
R 11
U 1
D 11
R 3
U 9
D 9
R 2
U 15
L 13
U 2
R 1
L 8
D 2
L 16
U 5
R 1
L 11
D 17
L 17
U 1
L 8
U 11
R 12
D 10
U 11
L 13
R 12
L 6
D 2
L 17
D 9
U 12
L 5
U 1
R 1
D 5
U 5
L 4
D 7
R 13
D 3
U 8
D 1
R 7
L 15
D 15
R 11
U 18
L 3
D 16
U 17
D 13
R 9
L 14
R 14
L 8
U 16
R 13
D 7
R 15
U 16
R 3
U 9
R 8
L 2
D 3
R 10
D 17
U 6
L 10
U 15
L 7
D 3
R 2
D 1
R 18
D 6
U 9
R 13
D 14
U 13
L 13
D 17
R 16
L 6
U 8
L 1
R 7
L 7
U 13
R 3
D 4
L 16
U 15
L 5
U 3
D 3
U 12
L 5
D 14
R 6
D 3
R 4
L 18
D 16
U 12
R 14
U 9
R 5
U 19
L 17
R 8
U 15
D 9
L 8
D 8
U 6
L 4
U 19
D 17
U 8
R 19
L 8
U 8
L 16
R 6
L 5
U 7
D 6
U 10
L 11
D 11
U 7
L 6
U 13
D 18
U 17
R 11
U 19
D 5
L 3
U 6
D 3
U 9
R 8
L 7
R 16
L 15
D 12
U 10
L 16
R 17
U 12
L 1
D 5
L 9
U 12
L 2
D 18
L 1
R 1
L 2
R 2
L 9
U 18
R 8
D 8
R 4
L 16
U 6
R 11
D 13
R 1
D 14
L 6
D 14
R 8
L 5
D 6
L 14
U 11
L 5
R 8
D 11
L 6
U 17
R 15
L 13
U 16
D 2
R 8
D 5
L 8
D 7
R 5
U 10
L 19
R 7
D 16
R 1
L 12
D 8
L 8
R 10
L 10
U 1
R 10
U 15"
  def input do
    @input
    |> String.split("\n")
    |> Enum.map(fn line -> String.trim(line) end)
    |> Enum.filter(fn line -> String.length(line) > 0 end)
  end
end

defmodule Day09 do
  defmodule Rope do
    defstruct knots: [{0, 0}, {0, 0}], tail_positions: MapSet.new()
  end

  def sign(int) when int >= 0, do: 1
  def sign(int) when int < 0, do: -1

  def move_tail_amount(head, tail) do
    {hx, hy} = head
    {tx, ty} = tail

    {dx, dy} = {hx - tx, hy - ty}

    {tdx, tdy} =
      case {abs(dx), abs(dy)} do
        {0, 0} ->
          {0, 0}

        {1, 0} ->
          {0, 0}

        {2, 0} ->
          {1, 0}

        {0, 1} ->
          {0, 0}

        {0, 2} ->
          {0, 1}

        {1, 1} ->
          {0, 0}

        {2, 1} ->
          {1, 1}

        {1, 2} ->
          {1, 1}

        {2, 2} ->
          {1, 1}
      end

    {tdx * sign(dx), tdy * sign(dy)}
  end

  def move_tail(rope, []) do
    rope
  end

  def move_tail(rope, [tail]) do
    %Rope{rope | tail_positions: MapSet.put(rope.tail_positions, tail)}
  end

  def move_tail(rope, [first, second | rest]) do
    {tx, ty} = second
    {dx, dy} = move_tail_amount(first, second)

    rope = %Rope{
      rope
      | knots: [{tx + dx, ty + dy} | rope.knots]
        # tail_positions: MapSet.put(rope.tail_positions, {tx + dx, ty + dy})
    }

    move_tail(rope, [second | rest])
  end

  def move_tail(rope) do
    [head | tail] = rope.knots

    rope = move_tail(%Rope{rope | knots: []}, rope.knots)

    %Rope{
      rope
      | knots: [head | Enum.reverse(rope.knots)]
    }
  end

  def move(rope, 0, _dir) do
    rope
  end

  def move(rope, amount, dir) do
    [{hx, hy} | tail] = rope.knots

    rope =
      case dir do
        :up -> %Rope{rope | knots: [{hx, hy - 1} | tail]}
        :down -> %Rope{rope | knots: [{hx, hy + 1} | tail]}
        :left -> %Rope{rope | knots: [{hx - 1, hy} | tail]}
        :right -> %Rope{rope | knots: [{hx + 1, hy} | tail]}
      end
      |> move_tail()

    move(rope, amount - 1, dir)
  end

  def string_to_direction(str) do
    case str do
      "R" -> :right
      "L" -> :left
      "U" -> :up
      "D" -> :down
    end
  end

  def get_instructions do
    Input.input()
    |> Enum.map(fn line ->
      [dir, amount] = String.split(line, " ")
      {string_to_direction(dir), String.to_integer(amount)}
    end)
  end

  def part1 do
    result =
      get_instructions()
      |> Enum.reduce(%Rope{}, fn {dir, amount}, rope ->
        move(rope, amount, dir)
      end)

    IO.puts("Part 1")
    IO.inspect({MapSet.size(result.tail_positions)})
  end

  def part2 do
    knots = Enum.to_list(0..9) |> Enum.map(fn _ -> {0, 0} end)

    result =
      get_instructions()
      |> Enum.reduce(%Rope{knots: knots}, fn {dir, amount}, rope ->
        move(rope, amount, dir)
      end)

    IO.puts("Part 2")
    IO.inspect({MapSet.size(result.tail_positions)})
  end
end

Day09.part1()
Day09.part2()
